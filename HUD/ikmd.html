<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WebAR Video Overlay</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
      /* スタートボタンの見た目 */
      #start-btn {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        padding: 15px 30px;
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border: 2px solid white;
        font-size: 20px;
        border-radius: 10px;
        z-index: 9999; /* 最前面に表示 */
        cursor: pointer;
      }
    </style>
  </head>
  
  <body style="margin: 0; overflow: hidden;">
    
    <div id="start-btn">TAP TO START</div>

    <script>
      AFRAME.registerShader('chromakey', {
        schema: {
          src: {type: 'map'},
          color: {default: {x: 0.1, y: 0.9, z: 0.2}, type: 'vec3'},
          threshold: {default: 0.1, type: 'number'}
        },
        init: function (data) {
          const videoTexture = new THREE.VideoTexture(data.src);
          videoTexture.format = THREE.RGBAFormat;
          this.material = new THREE.ShaderMaterial({
            uniforms: {
              texture: { value: videoTexture },
              color: { value: data.color },
              threshold: { value: data.threshold }
            },
            vertexShader: `
              varying vec2 vUv;
              void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
              }
            `,
            fragmentShader: `
              uniform sampler2D texture;
              uniform vec3 color;
              uniform float threshold;
              varying vec2 vUv;
              void main() {
                vec4 texel = texture2D( texture, vUv );
                float dist = distance(texel.rgb, color);
                if (dist < threshold) {
                  discard;
                }
                gl_FragColor = texel;
              }
            `,
            transparent: true
          });
        }
      });
    </script>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
      <a-assets>
        <video id="my-video" src="ikmd.mp4" loop="true" crossorigin="anonymous" playsinline webkit-playsinline muted></video>
      </a-assets>

      <a-camera position="0 0 0" look-controls="enabled: false">
        <a-entity geometry="primitive: plane" material="color: red" position="0 0 -2"></a-entity>
      </a-camera>
    </a-scene>

    <script>
      // ボタンを押したら動画を再生してボタンを消す
      document.querySelector('#start-btn').addEventListener('click', function (e) {
        var v = document.querySelector('#my-video');
        v.play();
        e.target.style.display = 'none'; // ボタンを非表示に
      });
    </script>
  </body>
</html>
